# このリポジトリについて

「低レイヤを知りたい人のためのCコンパイラ作成入門」を学ぶためのリポジトリです。
https://www.sigbus.info/compilerbook


## レジスタ一覧

x86-64でのレジスタについて参照用にまとめます。

### RSP
- スタックポインタとして使うことを念頭に置いて設計されている。
- x86-64のpushやpop命令は、暗黙のうちにRSPをスタックポインタとして使って、その値を変更しつつ、RSPが指しているメモリにアクセスする命令。
- `1+2` をスタックマシンと見立ててコンパイルする例。

```
// 左辺と右辺をプッシュ
push 1
push 2

// 左辺と右辺をRAXとRDIにポップ
pop rdi
pop rax
add rax, rdi

// 足した結果をスタックにプッシュ
push rax
```

### RBP
- RSPはpush、popを行う度に変更される。
- 従って、関数フレームの変数にRSPからの固定オフセットではアクセスできない。
- 関数フレームの開始位置を常に指しているレジスタを用意すれば解決できる。
- そのレジスタをベースレジスタと呼び、入っている値をベースポインタと呼ぶ。
- x86-64では慣習としてRBPレジスタをベースレジスタとして使用する。
- 上記より当たり前だが関数実行中はベースレジスタを変更してはならない。
- 関数呼び出し毎にベースポインタを保存しておいて、リターンをする前に書き戻す必要がある。
